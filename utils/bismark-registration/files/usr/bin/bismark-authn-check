#!/bin/sh

if [ -f "/etc/bismark/authn" ] ; then
    	. /usr/lib/bismark/functions.inc.sh
    	sleep $(random 0 120)
	cat /etc/bismark/authn | xargs curl -s | grep -q "good token"
	if [ $? == 0 ] ; then
		/etc/init.d/nodogsplash stop &>/dev/null
		exit 0
	else
		cat /etc/bismark/authn | xargs curl -s | grep -q "authenticate"
		if [ $? == 0 ] ; then
			/etc/init.d/nodogsplash restart &>/dev/null
			exit 1
		fi
	fi
else
	/etc/init.d/nodogsplash restart &>/dev/null
	exit 1
fi
